# MESI和Dragon协议

## 2007
r1, r1, r1, r2, r2, r2, r3, r3, r3, w1, w1, w1, w2, w1, w1, w3, r3

MESI: T H H T H H T H H B H H T T H T H = 610
Dragon: T H H T H H T H H B B B B B B B H = 697

## 2008
r1, r1, r2, r2, r3, r3, r4, r4, w1, w1, w1, w2, w2, w3, w3, w4, w4

MESI: T H T H T H T H B H H T H T H T H
Dragon: T H T H T H T H B B B B B B B B B

## 分析过程
二者读取开销类似，每次未命中均为一次**块传输**，写入时MESI的第一次写入是一次总线事务，随后只要写入命中即为H，未命中时需要使用flush将数据刷新给其他缓存，是一次块传输T
Dragon在每次写入后均会触发一次Update，由于只Update更新的内容，故开销为一次普通总线事务，无论是否写命中均相同。

# 内存一致性
## 2007
根据三个程序的特征，可以确定，在输出最后两位的时候，至少有两个变量会被设置为非0值，且最后一个print所打印两个变量必然非0，故可以得到三种非法输出$$****00, ****0*, *****0$$
当完成前两位输出后，此时至少会有一个变量被设置为非0，且该变量一定会在后续两次输出中被输出，故可以知道中间两位必然全不为0，得到一种非法输出
$$**00**$$
根据上面的分析，可能的合法输出有
$$000111, 001011, 001111, 010111, 011011, 011111, 100111, 101011, 101111, 110111, 111011, 111111$$
当前两位均为0时，分析可知此时三个处理机必然有一个已经执行结束，而另外两个还未执行，分析中间两位，对于剩余两个未执行的处理机，中间两位为$01, 10, 11$均合法

当前两位为$01$时，此时可以知道在执行print的处理机之外还有某个处理机执行了赋值语句，此时可能的执行序列为`... P3.1 ... P1.2 ...`且在`P1.2`之前`P2.1`不能被执行，故中间两位可能的输出包括$10, 11$，同理假设其它可能的执行顺序，可以得到所有的可能输出包括$01, 10, 11$

同理，对于前两位为$10$的情况进行分析，可知中间两位的可能输出为$01, 10, 11$

当前两位为$11$时，此时可以知道三个赋值语句必然都被执行了，后续只存在一种合法输出，即$111111$

故最终所有的非法输出为$****00, ****0*, *****0, **00**, 110111, 111011$
其中$*$为通配符，可以为$0$或$1$

## 2008

根据题意，根据提议，(u, v, w)分别对应(B, A, C)，由于当u, v, w任意一个变量被赋值后，另外两个变量所对应的临时变量均会被改变为非0值，故对于任意一种0数量大于等于2的输出均为非法输出。

基于以上分析可以确定10种非法输出。

接下来考虑其他输出情况，输出中存在一个0的时候，可知对应输出的处理机必然在其他两个处理机开始执行之前完成执行，此时问题退化为两个处理机之间执行顺序的问题，故有$011, 102, 220$三者非法。

当输出中不存在0的情况，此时共有8中可能的输出，对其进行分别讨论

> 对于三个变量最终非0值的情况可以按照如下情况讨论
>
> P2.1 -> P3.1 ? B == 2 : B == 1
>
> P1.1 -> P3.2 ? A == 2 : A == 1
>
> P1.2 -> P2.2 ? C == 2 : C == 1
>
> 且若提前执行了对应处理机的第三句，则可以直接屏蔽上述判断

111: P3.1 P3.2 P2.1 P2.2 P1.1 P1.2 三个赋值任意进行

112: P3.1 P3.2 P2.1 P2.2 P3.3 P1.1 P1.2 剩余两个赋值任意

121: P3.1 P1.1 P3.2 P2.1 P2.2 P1.2 三个赋值任意执行

122: P1.1 P1.2 P3.1 P3.2 P2.1 P2.2 三个赋值任意执行

211: P2.1 P3.1 P3.2 P1.1 P2.2 P1.2 三个赋值任意执行

212: P2.1 P3.1 P3.2 P1.1 P1.2 P2.2 三个赋值任意执行

221: P2.1 P3.2 P1.1 P3.2 P2.2 P1.2 三个赋值任意执行

222: P2.1 P3.1 P1.1 P3.2 P1.2 P2.2 三个赋值任意进行

由此可得到所有的非法输出$*00, 0*0,00*, 000, 011, 102, 220$，其中$*$为通配符，可以为$0, 1, 2$的任意一个

# 路由

## 2008

> 多播路由中的编号计算方式
>
> - $y * n + x$ $y$为偶数
> - $y * n + n - x - 1$ $y$为奇数

![image-20230618145533475](./历年考试答案总结.assets/image-20230618145533475.png)

# 预取

## 2007

> 纯靠经验，没有技巧，建议多推测

​    T1  T2  T3  T4  T5  T6  T7  T8  T9  T10 T11

​            F1      A1  B2  C1  D2  E1      F1

b1  **F1**  **F1**  F1  F1  **C1**  **C1**  C1  C1  **F1**  **F1**  F1

b2  **B2**  **B2**  B2  B2  B2  B2  **E1**  **E1**  E1  E1  E1

b3          A1  **A1**  A1  **D2**  **D2**  D2  D2  D2  D2